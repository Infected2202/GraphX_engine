**Цели, границы, принципы**

## Цель

Создать устойчивый и воспроизводимый помесячный график смен, который:

* следует фиксированному циклу для каждого сотрудника;
* корректно переносит ночные на границах месяцев (N4/N8);
* чередует офисы A/B при каждом рабочем выходе;
* учитывает нормы часов (и сокращает **дневные** 12→8 при необходимости);
* даёт удобные артефакты (Excel/CSV) для проверки, анализа и ручной доводки.

## Границы

* **Единица генерации** — месяц; месяцы генерируются **последовательно**, с переносами и «хвостом» для согласования старта.
* **Ручные правки** после генерации допустимы.
* **Оптимизация покрытия** (минимум 2 дневных, помощники) — следующий слой поверх базы, не вшит в генератор по умолчанию.
* **Отпуска** — не влияют на паттерн (только учёт часов).

## Принципы (важно для дальнейшей разработки)

1. **Детерминизм.** При одном и том же конфиге результат идентичен.
2. **Эпоха ротации — 1 января**. Фаза дня = `(seed4 + дни_от_эпохи) % 4`. Новый год «обнуляет» якорь.
3. **Непрерывность между месяцами.** `work_turn` считается сквозным (включая переносы `N4/N8`).
4. **Порядок слоёв — не смешивать ответственность:**

   * генератор (база) → *(опц.)* балансировка/сдвиги → пост-перекраска (отпуска, сокращения) → отчёты/валидации.
5. **Жёсткие инварианты.** См. «Current-State» — раздел «Инварианты».
6. **Минимум магии.** Все «софт-правила» (перемешивание пар, помощники) — с фичефлагами/порогами в конфиге.

## Негативные цели (что **не** делаем базовым слоем)

* Не «вытягиваем» покрытие ценой ломки паттерна/переносов.
* Не смешиваем отпуск с генерацией (только пост-перекраска).
* Не навязываем CP-SAT/ILP — это опциональный улучшатель поверх шаблона.

## Контекст незавершённого PR-3 (важно учитывать)

* Сдвиги выполняем **только в начале месяца** (окно), `N8` **не трогаем**.
* Сейчас сдвиг «немой» (не меняет `shift_key`) — это основной блокер эффекта.
* При продолжении важно: реальное переназначение ключей смен, строгие критерии приёма и сохранение инвариантов.
